-- Services
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Create a ScreenGui for the ESP GUI
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local TabsFrame = Instance.new("Frame")
local ESPFrame = Instance.new("Frame")
local MiscFrame = Instance.new("Frame")
local TrollFrame = Instance.new("Frame")
local PlayerFrame = Instance.new("Frame")

local ESPTabButton = Instance.new("TextButton")
local MiscTabButton = Instance.new("TextButton")
local TrollTabButton = Instance.new("TextButton")
local PlayerTabButton = Instance.new("TextButton")

local ToggleESPButton = Instance.new("TextButton")
local FlyButton = Instance.new("TextButton")
local WalkSpeedSlider = Instance.new("TextButton")
local JumpPowerSlider = Instance.new("TextButton")
local LongJumpButton = Instance.new("TextButton")
local SpinButton = Instance.new("TextButton")

local LookButton = Instance.new("TextButton")
local FollowButton = Instance.new("TextButton")

local PlayerSelector = Instance.new("TextButton") -- Placeholder for player dropdown

-- Setup ScreenGui
ScreenGui.Parent = game.CoreGui

-- Setup MainFrame
MainFrame.Size = UDim2.new(0, 400, 0, 400) -- Widened to fit all buttons
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
MainFrame.Visible = true
MainFrame.Parent = ScreenGui

-- Setup TabsFrame
TabsFrame.Size = UDim2.new(1, 0, 0, 50)
TabsFrame.Position = UDim2.new(0, 0, 0, 0)
TabsFrame.BackgroundColor3 = Color3.new(0.1, 0.1, 0.1)
TabsFrame.Parent = MainFrame

-- Setup ESPFrame (for ESP tab content)
ESPFrame.Size = UDim2.new(1, 0, 1, -50)
ESPFrame.Position = UDim2.new(0, 0, 0, 50)
ESPFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
ESPFrame.Visible = true
ESPFrame.Parent = MainFrame

-- Setup MiscFrame (for Misc tab content)
MiscFrame.Size = UDim2.new(1, 0, 1, -50)
MiscFrame.Position = UDim2.new(0, 0, 0, 50)
MiscFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
MiscFrame.Visible = false
MiscFrame.Parent = MainFrame

-- Setup TrollFrame (for Troll tab content)
TrollFrame.Size = UDim2.new(1, 0, 1, -50)
TrollFrame.Position = UDim2.new(0, 0, 0, 50)
TrollFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
TrollFrame.Visible = false
TrollFrame.Parent = MainFrame

-- Setup PlayerFrame (for Player tab content)
PlayerFrame.Size = UDim2.new(1, 0, 1, -50)
PlayerFrame.Position = UDim2.new(0, 0, 0, 50)
PlayerFrame.BackgroundColor3 = Color3.new(0.15, 0.15, 0.15)
PlayerFrame.Visible = false
PlayerFrame.Parent = MainFrame

-- Setup the TabButton for ESP
ESPTabButton.Size = UDim2.new(0, 100, 0, 50)
ESPTabButton.Position = UDim2.new(0, 0, 0, 0)
ESPTabButton.Text = "ESP"
ESPTabButton.Parent = TabsFrame

-- Setup the TabButton for Misc
MiscTabButton.Size = UDim2.new(0, 100, 0, 50)
MiscTabButton.Position = UDim2.new(0, 100, 0, 0)
MiscTabButton.Text = "Misc"
MiscTabButton.Parent = TabsFrame

-- Setup the TabButton for Troll
TrollTabButton.Size = UDim2.new(0, 100, 0, 50)
TrollTabButton.Position = UDim2.new(0, 200, 0, 0)
TrollTabButton.Text = "Troll"
TrollTabButton.Parent = TabsFrame

-- Setup the TabButton for Player
PlayerTabButton.Size = UDim2.new(0, 100, 0, 50)
PlayerTabButton.Position = UDim2.new(0, 300, 0, 0)
PlayerTabButton.Text = "Player"
PlayerTabButton.Parent = TabsFrame

-- Player Selector (for Player tab)
PlayerSelector.Size = UDim2.new(0, 200, 0, 50)
PlayerSelector.Position = UDim2.new(0, 50, 0, 20)
PlayerSelector.Text = "Select Player"
PlayerSelector.Parent = PlayerFrame

local selectedPlayer = nil -- Store selected player

-- Function to update the selected player from dropdown
PlayerSelector.MouseButton1Click:Connect(function()
    local dropdownMenu = Instance.new("Frame") -- Simple dropdown placeholder
    dropdownMenu.Size = UDim2.new(0, 200, 0, 200)
    dropdownMenu.Position = UDim2.new(0, 50, 0, 80)
    dropdownMenu.BackgroundColor3 = Color3.new(0.2, 0.2, 0.2)
    dropdownMenu.Parent = PlayerFrame

    -- Create buttons for each player
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local playerButton = Instance.new("TextButton")
            playerButton.Size = UDim2.new(0, 200, 0, 40)
            playerButton.Text = player.Name
            playerButton.Parent = dropdownMenu

            playerButton.MouseButton1Click:Connect(function()
                selectedPlayer = player
                PlayerSelector.Text = "Selected: " .. player.Name
                dropdownMenu:Destroy()
            end)
        end
    end
end)

-- Look functionality (look towards selected player)
local looking = false
local function LookAtPlayer(target)
    local Character = LocalPlayer.Character
    local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

    while looking and target.Character do
        local targetPos = target.Character:WaitForChild("HumanoidRootPart").Position
        local lookDirection = (targetPos - HumanoidRootPart.Position).unit
        local newCFrame = CFrame.lookAt(HumanoidRootPart.Position, HumanoidRootPart.Position + lookDirection)
        HumanoidRootPart.CFrame = CFrame.new(HumanoidRootPart.Position, targetPos)

        RunService.Heartbeat:Wait()
    end
end

-- Follow functionality (follow the selected player)
local following = false
local function FollowPlayer(target)
    local Character = LocalPlayer.Character
    local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

    while following and target.Character do
        local targetPos = target.Character:WaitForChild("HumanoidRootPart").Position
        local direction = (targetPos - HumanoidRootPart.Position).unit
        HumanoidRootPart.CFrame = CFrame.new(HumanoidRootPart.Position, targetPos)
        HumanoidRootPart.Velocity = direction * 16 -- Adjust speed if necessary

        RunService.Heartbeat:Wait()
    end
end

-- Create Look button
LookButton.Size = UDim2.new(0, 200, 0, 50)
LookButton.Position = UDim2.new(0, 50, 0, 20)
LookButton.Text = "Look: OFF"
LookButton.Parent = TrollFrame

LookButton.MouseButton1Click:Connect(function()
    if selectedPlayer then
        looking = not looking
        LookButton.Text = "Look: " .. (looking and "ON" or "OFF")

        if looking then
            coroutine.wrap(LookAtPlayer)(selectedPlayer)
        end
    else
        LookButton.Text = "Select a Player!"
    end
end)

-- Create Follow button
FollowButton.Size = UDim2.new(0, 200, 0, 50)
FollowButton.Position = UDim2.new(0, 50, 0, 80)
FollowButton.Text = "Follow: OFF"
FollowButton.Parent = TrollFrame

FollowButton.MouseButton1Click:Connect(function()
    if selectedPlayer then
        following = not following
        FollowButton.Text = "Follow: " .. (following and "ON" or "OFF")

        if following then
            coroutine.wrap(FollowPlayer)(selectedPlayer)
        end
    else
        FollowButton.Text = "Select a Player!"
    end
end)

-- Tab functionality
ESPTabButton.MouseButton1Click:Connect(function()
    ESPFrame.Visible = true
    MiscFrame.Visible = false
    TrollFrame.Visible = false
    PlayerFrame.Visible = false
end)

MiscTabButton.MouseButton1Click:Connect(function()
    ESPFrame.Visible = false
    MiscFrame.Visible = true
    TrollFrame.Visible = false
    PlayerFrame.Visible = false
end)

TrollTabButton.MouseButton1Click:Connect(function()
    ESPFrame.Visible = false
    MiscFrame.Visible = false
    TrollFrame.Visible = true
    PlayerFrame.Visible = false
end)

PlayerTabButton.MouseButton1Click:Connect(function()
    ESPFrame.Visible = false
    MiscFrame.Visible = false
    TrollFrame.Visible = false
    PlayerFrame.Visible = true
end)

-- Keybind to toggle the menu (left Ctrl)
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.LeftControl then
        MainFrame.Visible = not MainFrame.Visible
    end
end)
